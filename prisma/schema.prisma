generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

model Horse {
    id String @id @default(uuid())

    userUid String
    user    User   @relation(fields: [userUid], references: [uid], onDelete: Cascade)

    // Relation to HorseCategory
    categoryId String
    category   HorseCategory @relation(fields: [categoryId], references: [id])

    name     String
    pedigree String?
    age      Int

    // Relation to HorseGender
    genderId String
    gender   HorseGender @relation(fields: [genderId], references: [id])

    height Int

    // Relation to HorseDiscipline
    disciplineId String
    discipline   HorseDiscipline @relation(fields: [disciplineId], references: [id])

    location String

    price Float

    description String
    // veterinaryDocumentAvailable Boolean @default(false)
    // xrayResultsAvailable        Boolean @default(false)

    // Relation to HorsePhoto
    photos   HorsePhoto[]
    videoUrl String?

    vetReport   HorseVetReport?
    xrayResults HorseXrayResults?

    status String @default("pending")

    createdAt       DateTime             @default(now())
    updatedAt       DateTime             @updatedAt
    favoriteByUsers UserFavoriteHorses[]

    @@index([status])
    @@index([categoryId])
}

// need to be added in admin panel
model HorseCategory {
    id        String   @id @default(uuid())
    name      String   @unique
    imageUrl  String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    horses    Horse[]
}

// need to be added in admin panel
model HorseGender {
    id        String   @id @default(uuid())
    name      String   @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    horses    Horse[]
}

model HorsePhoto {
    id        String   @id @default(uuid())
    url       String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    horseId String
    horse   Horse  @relation(fields: [horseId], references: [id], onDelete: Cascade)
}

// need to be added in admin panel
model HorseDiscipline {
    id        String   @id @default(uuid())
    name      String   @unique
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    horses    Horse[]
}

model HorseVetReport {
    id        String   @id @default(uuid())
    horseId   String   @unique
    horse     Horse    @relation(fields: [horseId], references: [id], onDelete: Cascade)
    url       String
    public    Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model HorseXrayResults {
    id        String   @id @default(uuid())
    horseId   String   @unique
    horse     Horse    @relation(fields: [horseId], references: [id], onDelete: Cascade)
    url       String
    public    Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

// -------------------------------------------------------------------------
model User {
    uid  String @id
    name String
    // firebaseUid String @unique

    phoneNumber    String?
    email          String? @unique
    whatsAppNumber String?

    verifiedSeller Boolean @default(false)

    userFavoriteHorses UserFavoriteHorses[]

    notifications Notification[]

    role String @default("user") // e.g., user, admin

    horses Horse[]

    reviews UserReview[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model UserFavoriteHorses {
    id      String @id @default(uuid())
    userUid String
    horseId String

    user  User  @relation(fields: [userUid], references: [uid], onDelete: Cascade)
    horse Horse @relation(fields: [horseId], references: [id], onDelete: Cascade)

    createdAt DateTime @default(now())

    @@unique([userUid, horseId]) // prevents duplicates
}

model UserReview {
    id        String   @id @default(uuid())
    userUid   String
    user      User     @relation(fields: [userUid], references: [uid], onDelete: Cascade)
    reviewer  String
    rating    Int
    comment   String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Notification {
    id        String   @id @default(uuid())
    userUid   String
    user      User     @relation(fields: [userUid], references: [uid], onDelete: Cascade)
    title     String
    message   String
    read      Boolean  @default(false)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
